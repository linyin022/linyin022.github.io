<!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,minimum-scale=1"><meta http-equiv="X-UA-Compatible" content="ie=edge"><meta name="author" content="Linyin"><title>个人笔记no.1-kingbase连接池爆满 | Linyin&#39;s Site</title><link rel="icon" href="https://file.xiaoke022.top/Photo/63498564a0287.jpg"><link rel="stylesheet" href="/css/style.css"><script src="https://file.xiaoke022.top/js/script.js"></script><script src="https://file.xiaoke022.top/js/tocbot.min.js"></script><script src="https://file.xiaoke022.top/js/iconfont.js"></script><script src="https://file.xiaoke022.top/js/View-image-min.js"></script><meta name="generator" content="Hexo 5.4.2"><link rel="stylesheet" href="/css/prism.css" type="text/css"></head><body><script>
        // this function is used to check current theme before page loaded.
        window.onload =function () {
            (() => {
                const currentTheme = window.localStorage && window.localStorage.getItem('theme') || '';
                const isDark = currentTheme === 'dark';
                const pagebody = document.getElementsByTagName('body')[0]
                if (isDark) {
                    pagebody.classList.add('dark-theme');
                    // mobile
                    document.getElementById("mobile-toggle-theme").innerText = "· Dark"
                } else {
                    pagebody.classList.remove('dark-theme');
                    // mobile
                    document.getElementById("mobile-toggle-theme").innerText = "· Light"
                }
            })();
        }
    </script><div class="wrapper"><header><nav class="navbar"><div class="container"><div class="navbar-header header-logo"><a href="/">Linyin&#39;s Site</a></div><div class="menu navbar-right" style="font-family:'Alibaba Sans',monospace"> <a class="menu-item" href="/archives">Posts</a> <a class="menu-item" href="/category">Categories</a> <a class="menu-item" href="/tag">Tags</a> <a class="menu-item" href="/about">About</a> <input id="switch_default" type="checkbox" class="switch_default"><label for="switch_default" class="toggleBtn"></label></div></div></nav><nav class="navbar-mobile" id="nav-mobile"><div class="container"><div class="navbar-header"><div> <a href="/">Linyin&#39;s Site</a><a id="mobile-toggle-theme">·&nbsp;Light</a></div><div class="menu-toggle" onclick="mobileBtn()">&#9776; Menu</div></div><div class="menu" id="mobile-menu"> <a class="menu-item" href="/archives">Posts</a> <a class="menu-item" href="/category">Categories</a> <a class="menu-item" href="/tag">Tags</a> <a class="menu-item" href="/about">About</a></div></div></nav></header><script>var mobileBtn=function(){var e=document.getElementsByClassName("menu-toggle")[0],t=document.getElementById("mobile-menu");e.classList.contains("active")?(e.classList.remove("active"),t.classList.remove("active")):(e.classList.add("active"),t.classList.add("active"))}</script><div class="main"><div class="container"><article class="post-wrap"><header class="post-header"><h1 class="post-title">个人笔记no.1-kingbase连接池爆满</h1><div class="post-meta"> Author: <a itemprop="author" rel="author" href="/">Linyin</a> <span class="post-time">Date: <a href="#">八月 19, 2024&nbsp;&nbsp;19:13:51</a></span> <span class="post-category">Category: <a href="/categories/%E4%B8%AA%E4%BA%BA%E7%AC%94%E8%AE%B0/">个人笔记</a></span></div></header><div class="post-content"><p>由于项目需要，所以使用的人大金仓这个国产库，今天在idea中突然报错显示：<strong>致命错误: 对不起, 已经有太多的客户</strong></p><p>网上一查原来是之前配置的<span style="color:red">kingbase.conf</span>配置文件中虽然配置了max_connections&#x3D;100，但是由于弄的授权文件是开发版，导致最大连接数限制在了最大10(蛋疼)</p><p><img src="https://file.xiaoke022.top/img/2024/08/Snipaste_2024-08-19_20-07-46.png/webp" alt="img"></p><p>解决办法：去官网下载企业版的授权文件替换并重启kingbase即可解决。</p><ol><li><p>下载企业版授权文件 - <a target="_blank" rel="noopener" href="https://www.kingbase.com.cn/sqwjxz/index.htm">点我去下载</a></p></li><li><p>替换服务器中的授权文件</p></li><li><p>替换配置文件，一般配置文件在ES&#x2F;V9或者V8&#x2F;data 目录下 ，记得备份原文件后再进行企业授权文件上传</p></li><li><p>给新的授权文件加权限</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">chown</span> -R kingbase:kingbase license.dat </span><br><span class="line"><span class="built_in">chmod</span> 751 license.dat</span><br></pre></td></tr></table></figure></li><li><p>重启kingbase</p></li><li><p>重启后进入sys_log目录下，查看<span style="color:red">startup.log</span>文件，如果没有出现将max_connect的值设置为10的话，就代表成功替换了企业授权文件。</p><p><img src="https://file.xiaoke022.top/img/2024/08/Snipaste_2024-08-19_20-34-33.png/webp" alt="img"></p></li></ol><hr><p>以下是几个linux命令</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">查看文件的最新xx条数据</span><br><span class="line"><span class="built_in">tail</span> -f [<span class="built_in">log</span>文件名] -n [要查看多少条数据]</span><br><span class="line">-----------------------------------------------------------------------------------------</span><br><span class="line">--查找配置文件</span><br><span class="line">find / -name kingbase.conf</span><br><span class="line">-----------------------------------------------------------------------------------------</span><br><span class="line">--查看最大连接数</span><br><span class="line"><span class="built_in">cat</span> /opt/Kingbase/ES/V9/data/kingbase.conf|grep connection</span><br><span class="line">-----------------------------------------------------------------------------------------</span><br><span class="line">--查看会话进程</span><br><span class="line">ps -ef | grep kingbase</span><br><span class="line">-----------------------------------------------------------------------------------------</span><br><span class="line">进入命令行：在bin目录下 ./ksql -p 54321 -U system <span class="built_in">test</span> 后输入密码</span><br><span class="line">停止数据库 service kingbase stop</span><br><span class="line">启动数据库 service kingbase start</span><br><span class="line">重启数据库 service kingbase restart</span><br><span class="line">查看数据库服务状态 service kingbase status</span><br></pre></td></tr></table></figure><p>相关sql语句</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">-- 查看最大并发连接量</span></span><br><span class="line"><span class="keyword">show</span> max_connections;</span><br><span class="line"><span class="comment">-- 查看当前连接数</span></span><br><span class="line"><span class="keyword">select</span> connections();</span><br><span class="line"><span class="comment">-- 查看连接详情</span></span><br><span class="line"><span class="keyword">select</span> <span class="operator">*</span> <span class="keyword">from</span> sys_stat_activity;</span><br><span class="line"><span class="comment">-- 关闭空闲连接</span></span><br><span class="line"><span class="keyword">SELECT</span> pg_terminate_backend(pid) <span class="keyword">FROM</span> pg_stat_activity <span class="keyword">WHERE</span> state<span class="operator">=</span><span class="string">&#x27;idle&#x27;</span>;</span><br><span class="line"><span class="comment">--查询license有效期</span></span><br><span class="line"><span class="keyword">select</span> GET_LICENSE_VALIDDAYS();</span><br></pre></td></tr></table></figure></div><section class="post-copyright"><p class="copyright-item"> <span>Author:</span> <span>Linyin</span></p><p class="copyright-item"> <span>Permalink:</span> <span><a href="https://linyin022.github.io/posts/2785130421.html">https://linyin022.github.io/posts/2785130421.html</a></span></p><p class="copyright-item"> <span>License:</span> <span>Copyright (c) 2019 <a target="_blank" rel="noopener" href="http://creativecommons.org/licenses/by-nc/4.0/">CC-BY-NC-4.0</a> LICENSE</span></p></section><section class="post-tags"><div> <span>Tag(s):</span> <span class="tag"><a href="/tags/%E7%AC%94%E8%AE%B0/"># 笔记</a></span></div><div> <a href="javascript:window.history.back();">back</a> <span>·</span> <a href="/">home</a></div></section><section class="post-nav"> <a class="next" rel="next" href="/posts/1362166353.html">解析电影种子文件命名</a></section></article></div></div><footer id="footer" class="footer"><div class="copyright"> <span>© Linyin | Powered by <a href="https://hexo.io" target="_blank">Hexo</a> & <a href="https://github.com/Siricee/hexo-theme-Chic" target="_blank">Chic</a></span></div></footer></div></body></html>